<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../styles/styles-page2.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
    <title>Cadastro</title>
</head>

<body>
    <header>
        <img src="../images/breakapp preto.png" alt="breakapp preto" height="30px" width="auto" />
    </header>

    <div class="wrapper">
        <div class="container">
            <div class="container-together">
                <div class="container-input">
                    <p>Peso(kg):</p>
                    <input id="peso" type="number" class="input-box" min="0" autocomplete="off" />
                </div>
                <div class="container-input">
                    <p>Altura(cm):</p>
                    <input id="altura" type="number" class="input-box" min="0" autocomplete="off" />
                </div>
            </div>

            <div class="container-input">
                <p>Sexo:</p>
                <div class="container-buttons">
                    <button type="button" id="masculino" class="sex-button-masc">Masculino</button>
                    <button type="button" id="feminino" class="sex-button-fem">Feminino</button>
                </div>
            </div>

            <div class="container-input">
                <p>Idade:</p>
                <input id="idade" type="number" min="0" max="120" class="input-box" autocomplete="off" />
            </div>

            <button type="button" class="button-next" id="btnNext">Próximo</button>

            <div id="resultado" style="display:none; margin-top: 20px;"></div>
            <a href="/login" class="a-register">Ir para login</a>
        </div>
    </div>

    <div id="popup-msg" class="popup-msg">
  <div class="popup-content" id="popup-text"></div>
</div>


    <script>
document.addEventListener("DOMContentLoaded", () => {

    const sexoButtons = document.querySelectorAll(".container-buttons button");
    const sexoInput = { value: "" };

    sexoButtons.forEach(button => {
        button.addEventListener("click", () => {
            sexoButtons.forEach(btn => btn.classList.remove("selected"));
            button.classList.add("selected");
            sexoInput.value = button.id;
        });
    });

    const btnNext = document.getElementById("btnNext");

    if (btnNext) {
        btnNext.addEventListener("click", async () => {

            const idade = parseInt(document.getElementById("idade").value);
            const peso = parseFloat(document.getElementById("peso").value);
            const altura = parseFloat(document.getElementById("altura").value);
            const sexo = sexoInput.value;

            if (!sexo) return mostrarMensagem("Selecione o sexo antes de continuar.");
            if (isNaN(idade) || isNaN(peso) || isNaN(altura))
                return mostrarMensagem("Preencha todos os campos corretamente.");

            const userData = {
                nome_usuario: localStorage.getItem("nome_usuario"),
                idade,
                peso,
                altura,
                sexo
            };

            try {
                const response = await fetch('/api/user/calcular', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();

                if (response.ok) {
                    mostrarMensagem("Cadastro concluído!");
                    setTimeout(()=>{ window.location.href="/login"; },1500);
                } else {
                    mostrarMensagem(data.erro || "Erro ao calcular");
                }
            } catch (error) {
                mostrarMensagem("Erro de conexão: " + error.message);
            }
        });
    }
});


function mostrarMensagem(texto) {
    const popup = document.getElementById("popup-msg");
    const content = document.getElementById("popup-text");

    content.textContent = texto;
    popup.classList.add("open");

    setTimeout(() => {
        popup.classList.remove("open");
    }, 1500);
}
</script>

</body>

</html>